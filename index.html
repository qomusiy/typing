<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>O'zbekcha Terish Testi</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-color: #1a1b26;
      --text-color: #c0caf5;
      --accent-color: #7dcfff;
      --correct-color: #9ece6a;
      --incorrect-color: #f7768e;
      --extra-color: #ff6b6b;
      --stats-color: #d900ff;
      --button-bg: #2a2e45;
      --button-hover: #3b3f5c;
      --active-color: #7aa2f7;
      --font-title: 'Orbitron', sans-serif;
      --font-size: 1.6rem;
    }
    [data-theme="yellow"]{--bg-color:#000;--text-color:#ffff00;--accent-color:#ffff00;--correct-color:#00ff00;--incorrect-color:#ff0000;--extra-color:#ff6b6b;--stats-color:#ff00ff;--button-bg:#111;--button-hover:#222;--active-color:#ffff00}
    [data-theme="neon"]{--bg-color:#0a0a0a;--text-color:#00ffff;--accent-color:#ff00ff;--correct-color:#00ff00;--incorrect-color:#ff0080;--extra-color:#ff6600;--stats-color:#ffff00;--button-bg:#1a1a2e;--button-hover:#16213e;--active-color:#00ffff}
    [data-theme="ocean"]{--bg-color:#001122;--text-color:#add8e6;--accent-color:#87ceeb;--correct-color:#20b2aa;--incorrect-color:#dc143c;--extra-color:#ff8c00;--stats-color:#9370db;--button-bg:#003366;--button-hover:#004488;--active-color:#87ceeb}
    [data-theme="minimal"]{--bg-color:#fff;--text-color:#333;--accent-color:#000;--correct-color:#4caf50;--incorrect-color:#f44336;--extra-color:#ff9800;--stats-color:#9c27b0;--button-bg:#f5f5f5;--button-hover:#e0e0e0;--active-color:#333}

    body{margin:0;background:var(--bg-color);background-size:400% 400%;animation:g 15s ease infinite;color:var(--text-color);font-family:'Courier New',monospace;height:100vh;width:100vw;overflow:hidden;position:relative;transition:all .3s}
    body.typing{animation:none;background:var(--bg-color)}
    @keyframes g{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    [data-theme="yellow"] body{background:linear-gradient(45deg,#000,#111,#000)}
    [data-theme="neon"] body{background:linear-gradient(45deg,#0a0a0a,#1a1a2e,#0a0a0a)}
    [data-theme="ocean"] body{background:linear-gradient(45deg,#001122,#003366,#001122)}
    [data-theme="minimal"] body{background:linear-gradient(45deg,#fff,#f5f5f5,#fff)}

    .container{display:flex;flex-direction:column;align-items:center;height:100vh;max-width:900px;margin:0 auto;padding:5px 20px;position:relative;z-index:1}
    .header{align-items:center;margin-bottom:0}
    .main-content{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;padding-top:5px}
    #timer{font-size:1.1rem;color:var(--accent-color);margin-bottom:6px}
    .quote{font-size:var(--font-size);line-height:calc(var(--font-size) * 1.5);user-select:none;margin:0 0 20px;width:100%;max-height:60vh;overflow-y:auto;white-space:pre-wrap;padding-right:10px}
    .quote span[data-original]{transition:color .06s}
    .quote span.correct[data-original]{color:var(--correct-color)}
    .quote span.incorrect[data-original]{color:var(--incorrect-color)}
    .quote span.extra{color:var(--extra-color);text-decoration:underline}

    /* Smooth cursor */
    .cursor{
      display:inline-block !important;
      width: 2px !important;
      min-width: 2px !important;
      max-width: 2px !important;
      height:var(--font-size);
      background:var(--accent-color);
      vertical-align:middle;
      border-radius:2px;
      animation:cursorPulse 1.2s infinite ease-in-out;
      transform-origin:center;
      flex-shrink: 0;
    }
    @keyframes cursorPulse{
      0%,100%{opacity:1;}
      50%    {opacity:0.4;}
    }

    #stats{margin:10px 0 20px;font-size:1.05rem;color:var(--stats-color)}
    #restartLink{display:inline-block;padding:10px 20px;background:var(--button-bg);color:var(--text-color);border-radius:6px;cursor:pointer;transition:all .3s;border:1px solid var(--button-bg)}
    #restartLink:hover{background:var(--button-hover)}
    .controls{display:flex;gap:10px;margin:10px 0;flex-wrap:wrap;justify-content:center;align-items:center}
    .length-btn,.font-btn{padding:8px 16px;background:var(--button-bg);color:var(--text-color);border:1px solid var(--button-bg);border-radius:5px;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:5px;text-decoration:none!important}
    .length-btn:hover,.font-btn:hover{background:var(--button-hover)}
    .length-btn.active,.font-btn.active{background:var(--active-color);color:var(--bg-color);border-color:var(--active-color)}
    #fontSizeDisplay{font-weight:bold;color:var(--accent-color);margin:0 10px}

    /* Theme selector â€“ buttons now show their own theme colors */
    .theme-selector{position:absolute;top:10px;right:10px;display:flex;gap:5px;z-index:10}
    .theme-btn{
      width:40px;height:40px;
      border-radius:5px;
      cursor:pointer;
      display:flex;align-items:center;justify-content:center;
      transition:all .2s;
      border:2px solid transparent;
    }
    .theme-btn:hover{transform:scale(1.1)}
    .theme-btn.active{
      border:2px solid var(--active-color);
      box-shadow:0 0 12px var(--active-color);
    }

    /* Each button shows its own theme color */
    .theme-btn[data-theme="dark"]    {background:#1a1b26; color:#c0caf5;}
    .theme-btn[data-theme="yellow"]  {background:#000;    color:#ffff00;}
    .theme-btn[data-theme="neon"]    {background:#0a0a0a; color:#00ffff;}
    .theme-btn[data-theme="ocean"]   {background:#001122; color:#87ceeb;}
    .theme-btn[data-theme="minimal"] {background:#fff;    color:#333;}

    h1{transition:opacity .3s;margin:10px 0;font-family:var(--font-title)}
    .fade{opacity:0;pointer-events:none}
    #celebration{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999}
    canvas#confetti{position:absolute;top:0;left:0;width:100%;height:100%}
  </style>
</head>
<body data-theme="dark">

  <div id="celebration"><canvas id="confetti"></canvas></div>

  <div class="theme-selector">
    <button class="theme-btn active"   data-theme="dark"    title="Dark"><i class="fas fa-moon"></i></button>
    <button class="theme-btn"          data-theme="yellow"  title="Yellow"><i class="fas fa-sun"></i></button>
    <button class="theme-btn"          data-theme="neon"    title="Neon"><i class="fas fa-lightbulb"></i></button>
    <button class="theme-btn"          data-theme="ocean"   title="Ocean"><i class="fas fa-water"></i></button>
    <button class="theme-btn"          data-theme="minimal" title="Minimal"><i class="fas fa-palette"></i></button>
  </div>

  <div class="container">
    <div class="header">
      <h1>- O'zbekcha Tayping Qil Akasi..</h1>
      <div class="controls">
        <a href="#" class="length-btn" data-length="short"><i class="fas fa-clock"></i> Qisqa</a>
        <a href="#" class="length-btn" data-length="medium"><i class="fas fa-book"></i> O'rta</a>
        <a href="#" class="length-btn" data-length="long"><i class="fas fa-scroll"></i> Uzun</a>
        <a href="#" class="font-btn" id="fontMinus"><i class="fas fa-minus"></i></a>
        <span id="fontSizeDisplay">26</span>
        <a href="#" class="font-btn" id="fontPlus"><i class="fas fa-plus"></i></a>
      </div>
    </div>
    <div class="main-content">
      <div id="timer">00:00</div>
      <div class="quote" id="quote"></div>
      <div id="stats"></div>
      <div id="restartLink"><i class="fas fa-redo"></i> Qayta boshlash</div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
  <script>
    const q=document.getElementById('quote'),s=document.getElementById('stats'),r=document.getElementById('restartLink'),
          lengthBtns=document.querySelectorAll('.length-btn'),
          ti=document.getElementById('timer'),h=document.querySelector('h1'),c=document.querySelector('.controls'),
          th=document.querySelectorAll('.theme-btn'),
          fontPlus = document.getElementById('fontPlus'),
          fontMinus = document.getElementById('fontMinus'),
          fontSizeDisplay = document.getElementById('fontSizeDisplay');

    let quote='',spans=[],idx=0,start=false,time=null,int=null,end=false,
        len=localStorage.getItem('selectedLength')||'medium',
        hist=[],cur=null,
        theme=localStorage.getItem('theme')||'dark',
        currentFontSize = 1.6;

    document.body.dataset.theme=theme;
    th.forEach(b=>b.classList.toggle('active',b.dataset.theme===theme));

    function updateFontSize(size) {
      currentFontSize = Math.max(1.0, Math.min(3.0, size));
      document.documentElement.style.setProperty('--font-size', `${currentFontSize}rem`);
      fontSizeDisplay.textContent = Math.round(currentFontSize * 16);
      localStorage.setItem('fontSize', currentFontSize.toString());
      if (start && idx < spans.length) {
        setTimeout(move, 0); // Re-position after resize
      }
    }

    // Load saved font size
    const savedFontSize = localStorage.getItem('fontSize');
    if (savedFontSize) {
      currentFontSize = parseFloat(savedFontSize);
      updateFontSize(currentFontSize);
    }

    const quotes={short:["Kelajakni bashorat qilishning eng yaxshi yo'li bu uni qurish.","Men yomon odam bo'lsam keragu, buni o'zim bilmasam kerak.","Shamdek yosh to'k, ko'ngil uying charog'on bo'lsin.","Kishi jasur bo'la olishi mumkin bo'lgan yagona vaqt, bu u qo'rqqanida.","Inson tabassumi bilan tarbiyasini, nimaga kulgani bilan saviyasini namoyon qiladi.","Kecha bu o'tmish, erta bu jumboq, lekin bugun bu tuhfa.","Rim bir kunda qurilmagan.","Bilim Makkaga yetib borgan, lekin amal qilish \"astanovka\"da ham emas.","Muhimi shokolad emas. Siz uni baham ko'rgan odamlardir.","Qilishing kerak bo'lgan ishni qil va nima bo'sa bo'lsin.","Ikkita kitob o'qigandan bitta kitobni ikki marta o'qigan afzal."],
      medium:["Las Vegas kazinosida yutishning yagona yo'li bu kirganingizdan so'ng imkon qadar tez chiqib ketishdir.","Tanaga qilichdek muomala qilsang qilich bo'ladi. Qog'ozdek muomala qilsang qog'oz bo'ladi.","Kimdir \"qila olaman\", kimdir \"qila olmayman\" deydi. Odatda ularning ikkisi ham haq.","Jismoniy shug'ullanish nafaqat bizni sog'lom, kuchli, chidamli va ko'rkam qiladi, balki aqlan ham o'stiradi.","Odamlar suratini bezatsa, sen siyratingni beza. Odamlar boshqalar aybidan so'z ochsa, sen o'z qusuringni o'yla.","Ey, do'st! Men Majnun emasman, ammo chaqirsang cho'li biyobonga borishga ham tayyorman.","Mashrabo ko'p so'zlama, oqillara, bir so'z yetar! Kar quloq bo'lsa agar: ming so'zlagin bejo ketar!","O'ylaring so'zlaringga, so'zlaring fe'lingga, fe'ling taqdiringga nuqs etadi. Go'zal o'yla, go'zal yasha.","Agar nimadandir qo'rqsang, shu narsani har kuni bajar. Borgan sari qo'rquv umuman yo'q bo'lib ketadi.","Bilim ko'p narsani bilish. O'sha narsalarni eng yaxshi yo'lda ishlata olish esa donolikdir.","Chalg'imay ishlang, kitob o'qing, o'ylang, yuring, yozing - g'alaba aniq, sabr qila olsangiz bas."],
      long:["Bu katta va go'zal dunyo. Ko'pchiligimiz, uni hechqaysi bo'lagini umuman ko'rolmasdan, o'zimiz tug'ilgan bir burchakda yashab, o'tib ketamiz. Men ko'pchiligimiz dek bo'lishni istamayman.","Biz kelib ketuvchi to'garak jahon Na boshi ma'lum na so'ngi ayon Hech kimsa rostini aytib berolmas Biz qaydan keldigu ketarmiz qayon Keksa yosh hayotga har kimki yetar Hammasi izma-iz birma-bir o'tar Bu dunyo hech kimga qolmas abadiy Ketdilar, ketamiz, kelishar, ketar","Insonni otash emas, o'z g'aflati yoqar. Barchadagi kamchilikni ko'rar-u, ammo o'ziga ko'rdek boqar. Nimaga qanday boqsang, u ham senga shunday boqar.","Xato qilgan bo'lsang, tan ol. Adashayotgan bo'lsang, savol so'ra. Tiqilib qolgan bo'lsang, yordam so'ra. Xato qilgan bo'lsang, undan o'rgan. O'rgandingmi? O'rgat.","Xalq dengizdir, xalq to'lqindir, xalq kuchdir, Xalq isyondir, xalq olovdir, xalq o'chdir... Xalq qo'zg'alsa kuch yo'qdirkim, to'xtatsin, Quvvat yo'qkim, xalq istagin yo'q etsin.","Bir qo'lida Qur'onu bittasida jom, Bazida halolmiz, bazida harom, Feruza osmonli gumbaz ostida Na chin musulmonmiz, na kofir tamom."]
    };

    function rand(l){return quotes[l][Math.floor(Math.random()*quotes[l].length)]}
    function render(){
      q.innerHTML='';quote.split('').forEach(ch=>{let sp=document.createElement('span');sp.textContent=ch;sp.dataset.original=1;q.appendChild(sp)});
      spans=[...q.querySelectorAll('[data-original]')];idx=0;
      cur=document.createElement('span');cur.className='cursor';q.insertBefore(cur,spans[0]||q);
      stop();start=false;time=null;end=false;hist=[];s.innerText='';ti.innerText='00:00';q.scrollTop=0
    }
    function setActiveLength(selectedLen){
      lengthBtns.forEach(btn=>btn.classList.toggle('active',btn.dataset.length===selectedLen));
      len=selectedLen;localStorage.setItem('selectedLength',selectedLen);
    }
    function begin(length){
      const newLen=length||len;
      quote=rand(newLen);
      render();
      setActiveLength(newLen);
      document.getElementById('celebration').style.opacity=0;
    }
    function timer(){if(start)return;start=true;document.body.classList.add('typing');time=Date.now();int=setInterval(()=>{ti.innerText=fmt(Date.now()-time)},250)}
    function stop(){clearInterval(int);int=null}
    function fmt(ms){let sec=Math.floor(ms/1000),m=('0'+Math.floor(sec/60)).slice(-2),ss=('0'+sec%60).slice(-2);return m+':'+ss}
    function move(){let n=spans[idx];if(n)q.insertBefore(cur,n);else q.appendChild(cur);setTimeout(() => {cur.scrollIntoView({block:'nearest'})}, 0)}
    function extra(ch){let sp=document.createElement('span');sp.className='extra';sp.textContent=ch;q.insertBefore(sp,cur);hist.push({el:sp,type:'extra'})}
    function back(){if(!hist.length)return;let last=hist.pop();if(last.type==='extra')last.el.remove();else{last.el.classList.remove('correct','incorrect');if(idx>0)idx--;move()}}
    function stats(){let cor=q.querySelectorAll('[data-original].correct').length,inc=q.querySelectorAll('[data-original].incorrect').length,ex=q.querySelectorAll('.extra').length,tot=cor+inc+ex,acc=tot?Math.round(cor/tot*100):100,ms=time?Date.now()-time:0,w=ms>0?(cor/5)/(ms/60000):0;return{acc,w,ms}}
    function done(){end=true;document.body.classList.remove('typing');stop();let{acc:a,w:w,ms:m}=stats();s.innerText=`Vaqt: ${fmt(m)} | WPM: ${Math.round(w)} | To'g'rilik: ${a}%`;h.classList.remove('fade');c.classList.remove('fade');if(a===100)party()}
    function party(){let cel=document.getElementById('celebration');cel.style.opacity=1;confetti({particleCount:400,spread:100,origin:{y:0.6}});setTimeout(()=>confetti({particleCount:200,angle:60,origin:{x:0}}),300);setTimeout(()=>confetti({particleCount:200,angle:120,origin:{x:1}}),600);setTimeout(()=>cel.style.opacity=0,6000)}

    document.addEventListener('keydown',e=>{
      if(end||e.ctrlKey||e.altKey||e.metaKey||['CapsLock','Shift','Tab','Escape'].includes(e.key))return;
      if(e.key==='Backspace'){back();return}
      if(e.key==='Enter'){
        if(idx >= spans.length) return;
        const expected = spans[idx].textContent;
        if(expected === '\n'){
          // Match explicit newline
          spans[idx].classList.add('correct');
          hist.push({el:spans[idx],type:'original'});
          idx++;
          setTimeout(move, 0);
          if(idx>=spans.length) done();
          return;
        } else if(idx < spans.length){
          // Check visual wrap: if next char on new line, advance
          const curRect = cur.getBoundingClientRect();
          const nextRect = spans[idx].getBoundingClientRect();
          if(curRect.top < nextRect.top - 1){ // Small tolerance for floating point
            // Visual end of line, advance without penalty
            idx++;
            setTimeout(move, 0);
            return;
          }
        }
        return; // Ignore otherwise
      }
      if(!start)timer();
      let ch = e.key;
      if(idx>=spans.length){if(ch.length===1){extra(ch)}return}
      let exp=spans[idx].textContent;
      if(ch===exp){spans[idx].classList.add('correct');hist.push({el:spans[idx],type:'original'});idx++;move();if(idx>=spans.length)done()}
      else{if(ch.length===1){extra(ch)}}
    });

    r.onclick=()=>begin();
    lengthBtns.forEach(b=>b.onclick=e=>{e.preventDefault();begin(b.dataset.length)});
    fontPlus.onclick = e => { e.preventDefault(); updateFontSize(currentFontSize + 0.1); };
    fontMinus.onclick = e => { e.preventDefault(); updateFontSize(currentFontSize - 0.1); };
    th.forEach(b=>b.onclick=e=>{
      e.preventDefault();
      theme=b.dataset.theme;
      document.body.dataset.theme=theme;
      localStorage.setItem('theme',theme);
      th.forEach(x=>x.classList.toggle('active',x.dataset.theme===theme));
    });

    setActiveLength(len);
    begin(len);
  </script>
</body>
</html>